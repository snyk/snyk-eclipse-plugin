<!--
  Fallback settings page shown when the Language Server is not yet available.
  Once the CLI is downloaded and the LS is running, the full settings
  panel will be served by the LS and this fallback will be replaced automatically.
  
  Template placeholders:
    {{MANAGE_BINARIES_CHECKED}} - "checked" or ""
    {{CLI_BASE_DOWNLOAD_URL}} - download URL string
    {{CLI_PATH}} - CLI path string
    {{CHANNEL_STABLE_SELECTED}} - "selected" or ""
    {{CHANNEL_RC_SELECTED}} - "selected" or ""
    {{CHANNEL_PREVIEW_SELECTED}} - "selected" or ""
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snyk Configuration</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            font-size: 13px;
            color: #333333;
            background-color: #ffffff;
            padding: 20px;
            margin: 0;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 20px;
            color: #1a1a1a;
        }

        h2 {
            font-size: 18px;
            margin-top: 20px;
            margin-bottom: 15px;
            color: #1a1a1a;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 8px;
        }

        .section {
            margin-bottom: 30px;
            padding: 15px;
            background-color: #f5f5f5;
            border-radius: 4px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333333;
        }

        .checkbox-label {
            display: inline-flex !important;
            align-items: center;
            font-weight: normal;
            cursor: pointer;
            user-select: none;
        }

        .checkbox-label input[type="checkbox"] {
            margin-right: 8px;
            cursor: pointer;
            -webkit-appearance: checkbox;
            width: 16px;
            height: 16px;
            pointer-events: auto;
        }

        input[type="text"],
        select {
            width: 100%;
            padding: 8px;
            background-color: #ffffff;
            color: #333333;
            border: 1px solid #cccccc;
            border-radius: 2px;
            box-sizing: border-box;
            font-family: inherit;
            font-size: inherit;
        }

        input:focus,
        select:focus {
            outline: 1px solid #0066cc;
            outline-offset: -1px;
        }

        .description {
            display: block;
            font-size: 11px;
            color: #666666;
            margin-top: 4px;
            font-style: italic;
        }

        .info-message {
            padding: 15px;
            background-color: #e7f3ff;
            border: 1px solid #0066cc;
            border-radius: 4px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <h1>Snyk Configuration</h1>

    <div class="info-message">
        <strong>Note:</strong> The Snyk CLI is not yet available. Configure the executable settings below to download and set up the CLI.
        <br><br>
        <strong>Limited settings mode:</strong> Only CLI download settings are currently available. Once the CLI is downloaded,
        additional options will appear including authentication, scan types, severity filters, and organization settings.
    </div>

    <form id="configForm">
        <div class="section">
            <h2>Executable Settings</h2>

            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" name="manageBinariesAutomatically" id="manageBinariesAutomatically" {{MANAGE_BINARIES_CHECKED}}>
                    Automatically manage needed binaries
                </label>
                <span class="description">If enabled, the plugin will automatically download and update the Snyk CLI.</span>
            </div>

            <div class="form-group">
                <label for="cliBaseDownloadURL">Base URL to download the CLI</label>
                <input type="text" id="cliBaseDownloadURL" name="cliBaseDownloadURL" value="{{CLI_BASE_DOWNLOAD_URL}}" placeholder="https://downloads.snyk.io">
                <span class="description">The default URL is https://downloads.snyk.io. For FIPS-enabled CLIs (Windows/Linux only), use https://downloads.snyk.io/fips</span>
            </div>

            <div class="form-group">
                <label for="cliPath">Path to Snyk CLI</label>
                <input type="text" id="cliPath" name="cliPath" value="{{CLI_PATH}}" placeholder="/path/to/snyk-cli">
                <span class="description">The path where the Snyk CLI executable is or will be located.</span>
            </div>

            <div class="form-group">
                <label for="cliReleaseChannel">CLI Release Channel</label>
                <select id="cliReleaseChannel" name="cliReleaseChannel">
                    <option value="stable" {{CHANNEL_STABLE_SELECTED}}>stable</option>
                    <option value="rc" {{CHANNEL_RC_SELECTED}}>rc</option>
                    <option value="preview" {{CHANNEL_PREVIEW_SELECTED}}>preview</option>
                </select>
                <span class="description">Choose which release channel to use for CLI updates.</span>
            </div>
        </div>
    </form>

    <script>
        (function() {
            window.__modified__ = false;

            function get(id) {
                return document.getElementById(id);
            }

            function collectData() {
                return {
                    cliPath: get('cliPath').value,
                    manageBinariesAutomatically: get('manageBinariesAutomatically').checked,
                    cliBaseDownloadURL: get('cliBaseDownloadURL').value,
                    cliReleaseChannel: get('cliReleaseChannel').value
                };
            }

            function markModified() {
                window.__modified__ = true;
                if (typeof window.__ideNotifyModified__ === 'function') {
                    window.__ideNotifyModified__();
                }
            }

            window.saveConfig = function() {
                var data = collectData();
                var jsonString = JSON.stringify(data);
                try {
                    if (typeof window.__ideSaveConfig__ === 'function') {
                        window.__ideSaveConfig__(jsonString);
                        window.__modified__ = false;
                    }
                } catch (e) {
                    console.error('Error saving configuration:', e);
                }
            };

            window.addEventListener('load', function() {
                var form = get('configForm');
                if (!form) return;

                var inputs = form.getElementsByTagName('input');
                var selects = form.getElementsByTagName('select');

                for (var i = 0; i < inputs.length; i++) {
                    inputs[i].addEventListener('input', markModified);
                    inputs[i].addEventListener('change', markModified);
                }

                for (var j = 0; j < selects.length; j++) {
                    selects[j].addEventListener('change', markModified);
                }
            });
        })();
    </script>
</body>
</html>
